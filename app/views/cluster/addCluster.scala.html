@*
* Copyright 2015 Yahoo Inc. Licensed under the Apache License, Version 2.0
* See accompanying LICENSE file.
*@
@(addClusterForm: Form[kafka.manager.model.ClusterConfig])(implicit messages: play.api.i18n.Messages, menus: models.navigation.Menus, request:RequestHeader)

@import controllers.routes

@theMenu = {
    @views.html.navigation.defaultMenu(views.html.navigation.menuNav("Cluster","Add Cluster",menus.indexMenu))
}

@checkboxWithLink(field: play.api.data.Field)(implicit fc: b4.B4FieldConstructor, msgsProv: MessagesProvider) = {
@b4.inputFormGroup(field, withLabelFor = false, views.html.bs.Args.withDefault(Seq(), Symbol("disabled") -> false)) { fieldInfo =>
<div class="checkbox">
    <label for="@fieldInfo.id">
        <input type="checkbox" id="@fieldInfo.id" name="@fieldInfo.name" value="true" @if(fieldInfo.value == Some("true")){checked} @toHtmlArgs(fieldInfo.innerArgsMap)>
        Display Broker and Topic Size (only works after applying <a href="https://issues.apache.org/jira/browse/KAFKA-1614">this patch</a>)
    </label>
</div>
}
}

@drawForm(form : Form[kafka.manager.model.ClusterConfig]) = {
    @b4.vertical.form(routes.Cluster.handleAddCluster.copy(url = routes.Cluster.handleAddCluster.relative)) { implicit fc =>
    <fieldset>
        @b4.text(form("name"), Symbol("_label") -> "Cluster Name", Symbol("placeholder") -> "", Symbol("autofocus") -> true )
        @b4.text(form("zkHosts"), Symbol("_label") -> "Cluster Zookeeper Hosts", Symbol("placeholder") -> "zk1:2181,zk2:2181,zk3:2181/NAMESPACE")
        @b4.select( form("kafkaVersion"), options = kafka.manager.model.KafkaVersion.formSelectList, Symbol("_label") -> "Kafka Version" )
        @b4.checkbox(form("jmxEnabled"), Symbol("_text") -> "Enable JMX Polling (Set JMX_PORT env variable before starting kafka server)")
        @b4.text(form("jmxUser"), Symbol("_label") -> "JMX Auth Username")
        @b4.text(form("jmxPass"), Symbol("_label") -> "JMX Auth Password")
        @b4.checkbox(form("jmxSsl"), Symbol("_text") -> "JMX with SSL")
        @b4.checkbox(form("logkafkaEnabled"), Symbol("_text") -> "Enable Logkafka")
        @b4.checkbox(form("pollConsumers"), Symbol("_text") -> "Poll consumer information (Not recommended for large # of consumers if ZK is used for offsets tracking on older Kafka versions)")
        @b4.checkbox(form("filterConsumers"), Symbol("_text") -> "Filter out inactive consumers")
        @b4.checkbox(form("activeOffsetCacheEnabled"), Symbol("_text") -> "Enable Active OffsetCache (Not recommended for large # of consumers)")
        @checkboxWithLink(form("displaySizeEnabled"))
        @b4.number(form("tuning.brokerViewUpdatePeriodSeconds"), Symbol("_label") -> "brokerViewUpdatePeriodSeconds")
        @b4.number(form("tuning.clusterManagerThreadPoolSize"), Symbol("_label") -> "clusterManagerThreadPoolSize")
        @b4.number(form("tuning.clusterManagerThreadPoolQueueSize"), Symbol("_label") -> "clusterManagerThreadPoolQueueSize")
        @b4.number(form("tuning.kafkaCommandThreadPoolSize"), Symbol("_label") -> "kafkaCommandThreadPoolSize")
        @b4.number(form("tuning.kafkaCommandThreadPoolQueueSize"), Symbol("_label") -> "kafkaCommandThreadPoolQueueSize")
        @b4.number(form("tuning.logkafkaCommandThreadPoolSize"), Symbol("_label") -> "logkafkaCommandThreadPoolSize")
        @b4.number(form("tuning.logkafkaCommandThreadPoolQueueSize"), Symbol("_label") -> "logkafkaCommandThreadPoolQueueSize")
        @b4.number(form("tuning.logkafkaUpdatePeriodSeconds"), Symbol("_label") -> "logkafkaUpdatePeriodSeconds")
        @b4.number(form("tuning.partitionOffsetCacheTimeoutSecs"), Symbol("_label") -> "partitionOffsetCacheTimeoutSecs")
        @b4.number(form("tuning.brokerViewThreadPoolSize"), Symbol("_label") -> "brokerViewThreadPoolSize")
        @b4.number(form("tuning.brokerViewThreadPoolQueueSize"), Symbol("_label") -> "brokerViewThreadPoolQueueSize")
        @b4.number(form("tuning.offsetCacheThreadPoolSize"), Symbol("_label") -> "offsetCacheThreadPoolSize")
        @b4.number(form("tuning.offsetCacheThreadPoolQueueSize"), Symbol("_label") -> "offsetCacheThreadPoolQueueSize")
        @b4.number(form("tuning.kafkaAdminClientThreadPoolSize"), Symbol("_label") -> "kafkaAdminClientThreadPoolSize")
        @b4.number(form("tuning.kafkaAdminClientThreadPoolQueueSize"), Symbol("_label") -> "kafkaAdminClientThreadPoolQueueSize")
        @b4.number(form("tuning.kafkaManagedOffsetMetadataCheckMillis"), Symbol("_label") -> "kafkaManagedOffsetMetadataCheckMillis")
        @b4.number(form("tuning.kafkaManagedOffsetGroupCacheSize"), Symbol("_label") -> "kafkaManagedOffsetGroupCacheSize")
        @b4.number(form("tuning.kafkaManagedOffsetGroupExpireDays"), Symbol("_label") -> "kafkaManagedOffsetGroupExpireDays")
        @b4.select(form("securityProtocol"), options = kafka.manager.model.SecurityProtocol.formSelectList, Symbol("_label") -> "Security Protocol" )
        @b4.select(form("saslMechanism"), options = kafka.manager.model.SASLmechanism.formSelectList, Symbol("_label") -> "SASL Mechanism (only applies to SASL based security)" )
        @b4.text(form("jaasConfig"), Symbol("_label") -> "SASL JAAS Config (only applies to SASL based security)")
        @b4.submit(Symbol("class") -> "submit-button btn btn-primary"){ Save }
        <a href="@routes.Application.index" class="cancel-button btn btn-secondary" role="button">Cancel</a>
    </fieldset>
    }
}

@main("Add Cluster", menu = theMenu, breadcrumbs = views.html.navigation.breadCrumbs(models.navigation.BreadCrumbs.withView("Add Cluster"))) {
    <div class="col-md-6 un-pad-me">
        <div class="card">
            <div class="card-header"><h3><button type="button" class="btn btn-link" onclick="goBack()"><span class="octicon octicon-arrow-left" aria-hidden="true"></span></button>Add Cluster</h3></div>
            <div class="card-body">
                @drawForm(addClusterForm)
            </div>
        </div>
        @configReferences()
    </div>
}

